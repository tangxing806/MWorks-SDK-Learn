# 7. CustomizeRibbon工程

**描述：**自定义Ribbon菜单

**运行效果：**

![image-20210429095046961](https://tangxing-markdown-pic.oss-cn-shenzhen.aliyuncs.com/images/20210429095047.png)

**原始版本：**

![image-20210429094948893](https://tangxing-markdown-pic.oss-cn-shenzhen.aliyuncs.com/images/20210429094948.png)



## 7.1 帮助文档

**① 示例简介**

本示例主要展示自定义Ribbon菜单，包括：

* 修改应用名称
* 隐藏Ribbon分组
* 添加文件菜单
* Ribbon右键菜单改写

![image-20210429092731284](https://tangxing-markdown-pic.oss-cn-shenzhen.aliyuncs.com/images/20210429092731.png)



**②示例实现详解**

MWorks通过应用名取系统设置，通过继承 `MwDefaultFactory` ，重写`CreateAppName`方法可实现。

~~~cpp
QString CustomFactory::CreateAppName(bool is_simple)
{
    return "CustomizeRibbon";
}
~~~

![image-20210429093033143](https://tangxing-markdown-pic.oss-cn-shenzhen.aliyuncs.com/images/20210429093033.png)

`Ribbon`框架类包含： `RibbonBar` 、 `RibbonPage`、 `RibbonGroup`。

可以通过索引获取 `RibbonPage` 和 `RibbonGroup` ， SDK中 `MwRibbonBarHandler` 也提供 `GetRibbonPage()`、`GetRibbonGroup()` 方法。

~~~cpp
void CustomizeRibbon::HideExportGroup()
{
    pWorkBench->GetRibbonBar()->page(2)->groupAt(0)->hide();
}
~~~

通过`Ribbon`索引，还可以获取`QAction`，`MwWorkbenchAction` 也提供 `GetAction()` 方法。

 ~~~cpp
void CustomizeRibbon::HideLicenseAction()
{
    QAction *license_action = pWorkBench->GetActions()->GetAction(MwWorkbenchAction::AT_LICENSE);
    license_action->setVisible(false);

    //设置license
    //LicenseInfo info;
    //info.bStandalone = true;
    //info.strFilePath = qApp->applicationDirPath() + "\\license.lic";
    //MwLicenseUI::SetLicensePath(info);
}
 ~~~

改写 `MwRibbonBarHandler` 中 `GetRibbonContextActions()`方法可以定制`Ribbon右键菜单`。

重连 `RibbonBar` 中 `showRibbonContextMenu信号`也可以实现。

 ~~~cpp
disconnect(pWorkBench->GetRibbonBar(), SIGNAL(showRibbonContextMenu(QMenu*, QContextMenuEvent*)), nullptr, 0);
connect(pWorkBench->GetRibbonBar(), SIGNAL(showRibbonContextMenu(QMenu*, QContextMenuEvent*)),
        this, SLOT(ShowRibbonContextMenu(QMenu*, QContextMenuEvent*)));

void CustomizeRibbon::ShowRibbonContextMenu(QMenu*, QContextMenuEvent* event)
{
    event->setAccepted(false);

    QMenu menu;

    menu.addAction(pWorkBench->GetCore()->GetClassPanel()->GetWidgetAction());
    menu.addAction(pWorkBench->GetCore()->GetSimInstPanel()->GetWidgetAction());
    menu.addAction(pWorkBench->GetCore()->GetParamPanel()->GetWidgetAction());
    menu.addAction(pWorkBench->GetCore()->GetWatchPanel()->GetWidgetAction());
    menu.addAction(pWorkBench->GetActions()->GetAction(MwWorkbenchAction::AT_COMMAND));
    menu.addAction(pWorkBench->GetActions()->GetAction(MwWorkbenchAction::AT_OUTPUT));

    QAction* rc = new QAction(this);
    rc->setSeparator(true);
    menu.addAction(rc);

    menu.addAction(pStructPanel->GetWidgetAction());

    menu.exec(event->globalPos());
}
 ~~~

**类说明：**

![image-20210429093801718](https://tangxing-markdown-pic.oss-cn-shenzhen.aliyuncs.com/images/20210429093801.png)

## 7.2 main.cpp

